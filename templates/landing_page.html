<!DOCTYPE html>
<html lang="en">
    {% load static %}
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>SK Budget - Empowering Youth Leadership</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
        <script>
            tailwind.config = {
                theme: {
                    extend: {
                        colors: {
                            primary: '#F3CA52',
                            secondary: '#F6E9B2',
                            tertiary: '#0A6847',
                            quaternary: '#7ABA78',
                        }
                    }
                }
            }
        </script>
        <style>
            .glass-effect {
                background: rgba(255, 255, 255, 0.2);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.1);
            }
            .hero-pattern {
                background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%230a6847' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            }

            /* Barangay Logo Banner Styles */
            .barangay-logo-banner {
                background: rgba(255, 255, 255, 0.15);
                backdrop-filter: blur(5px);
                border-radius: 1rem;
                padding: 1rem;
                box-shadow: 0 4px 20px rgba(10, 104, 71, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.2);
                overflow: hidden;
            }

            .barangay-logo-item {
                width: 100px;
                height: 100px;
                border-radius: 50%;
                background-color: rgba(10, 104, 71, 0.1);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                transition: all 0.3s ease;
                position: relative;
                overflow: hidden;
                border: 2px solid rgba(10, 104, 71, 0.2);
            }

            .barangay-logo-item:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 20px rgba(10, 104, 71, 0.2);
                background-color: rgba(10, 104, 71, 0.2);
                border-color: rgba(10, 104, 71, 0.4);
            }

            .barangay-logo-image {
                width: 60px;
                height: 60px;
                display: flex;
                align-items: center;
                justify-content: center;
                margin-bottom: 0.25rem;
                border-radius: 50%;
                background-color: rgba(255, 255, 255, 0.8);
                overflow: hidden;
            }

            .barangay-logo-icon {
                font-size: 2rem;
                color: #0A6847;
            }

            .barangay-logo-name {
                font-size: 0.7rem;
                font-weight: bold;
                color: #0A6847;
                text-align: center;
                padding: 0 0.5rem;
                line-height: 1;
                max-width: 100%;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }

            @media (max-width: 640px) {
                .barangay-logo-item {
                    width: 70px;
                    height: 70px;
                }

                .barangay-logo-image {
                    width: 45px;
                    height: 45px;
                }

                .barangay-logo-icon {
                    font-size: 1.5rem;
                }

                .barangay-logo-name {
                    font-size: 0.55rem;
                }
            }

            @media (max-width: 480px) {
                .barangay-logo-item {
                    width: 60px;
                    height: 60px;
                }

                .barangay-logo-image {
                    width: 38px;
                    height: 38px;
                    margin-bottom: 0.1rem;
                }

                .barangay-logo-icon {
                    font-size: 1.2rem;
                }

                .barangay-logo-name {
                    font-size: 0.5rem;
                }

                .barangay-logos-container {
                    gap: 0.5rem;
                }
            }

            /* Utility classes */
            .line-clamp-2 {
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
                overflow: hidden;
            }

            .line-clamp-3 {
                display: -webkit-box;
                -webkit-line-clamp: 3;
                -webkit-box-orient: vertical;
                overflow: hidden;
            }
        </style>
    </head>
    <body class="bg-gradient-to-br from-secondary to-primary min-h-screen hero-pattern">
        <!-- Navbar -->
        <header class="fixed w-full top-0 z-50">
            <nav class="glass-effect text-tertiary py-4">
                <div class="container mx-auto px-4 flex justify-between items-center">
                    <h1 class="text-xl sm:text-2xl font-bold flex items-center">
                        <img src="{% static 'img/dumingag-logo.png' %}" alt="Dumingag Logo" class="h-8 sm:h-10 mr-3">
                        <span class="bg-clip-text text-transparent bg-gradient-to-r from-tertiary to-quaternary">SK Budget</span>
                    </h1>
                    <div class="flex items-center space-x-2 sm:space-x-4">
                        <a href="{% url 'register' %}" class="bg-tertiary hover:bg-quaternary text-white font-bold py-2 px-3 sm:px-6 rounded-full transition duration-300 transform hover:scale-105 text-xs sm:text-base">
                            <i class="fas fa-user-plus mr-1 sm:mr-2"></i><span class="hidden xs:inline">Register</span>
                        </a>
                        <a href="{% url 'login' %}" class="bg-tertiary hover:bg-quaternary text-white font-bold py-2 px-3 sm:px-6 rounded-full transition duration-300 transform hover:scale-105 text-xs sm:text-base">
                            <i class="fas fa-sign-in-alt mr-1 sm:mr-2"></i><span class="hidden xs:inline">Login</span>
                        </a>
                    </div>
                </div>
            </nav>
        </header>

        <!-- We'll move the search bar to the Recently Completed Projects section -->

        <main class="pt-20">
            <!-- Hero Section -->
            <section id="getStartedSection" class="container mx-auto px-4 py-8 sm:py-16">
                <div class="text-center max-w-5xl mx-auto">
                    <!-- Barangay Logo Banner -->
                    <div class="mb-8 overflow-hidden">
                        <div class="barangay-logo-banner relative">
                            <!-- Title for the banner -->
                            <div class="text-center mb-3">
                                <h3 class="text-lg sm:text-xl font-semibold text-tertiary">
                                    <i class="fas fa-map-marked-alt mr-2"></i>Barangays of Dumingag
                                </h3>
                                <p class="text-xs sm:text-sm text-gray-600">Click on a barangay logo to view its recent completed projects</p>
                            </div>
                            <!-- Scrollable container for barangay logos -->
                            <div class="barangay-logos-container flex items-center justify-center flex-wrap gap-4 py-2 px-2 sm:px-4">
                                <!-- Barangay logos will be dynamically generated -->
                            </div>
                            <!-- View all barangays button -->
                            <div class="text-center mt-4">
                                <button id="viewAllBarangays" class="inline-flex items-center px-4 py-2 rounded-full text-sm font-medium bg-tertiary text-white hover:bg-quaternary transition-colors duration-300">
                                    <i class="fas fa-th-large mr-2"></i>View All Barangays
                                </button>
                            </div>
                        </div>
                    </div>
                    <h2 class="text-3xl sm:text-4xl md:text-5xl font-bold text-tertiary mb-4 sm:mb-6 leading-tight">
                        <span class="block">Empowering Youth Leadership</span>
                        <span class="block text-xl sm:text-2xl md:text-3xl text-quaternary mt-2">Through Efficient Budget Management</span>
                    </h2>
                    <p class="text-base sm:text-lg md:text-xl text-gray-700 mb-6 sm:mb-10 max-w-2xl mx-auto">Transform your SK projects with our comprehensive budget management system. Track, manage, and report with ease.</p>
                    <a href="{% url 'register' %}" class="inline-block bg-tertiary hover:bg-quaternary text-white font-bold py-3 sm:py-4 px-6 sm:px-8 rounded-full text-base sm:text-xl transition duration-300 transform hover:scale-105 hover:shadow-lg">
                        <i class="fas fa-rocket mr-2"></i>Get Started Today
                    </a>
                </div>
            </section>

            <!-- Mission and Vision Section -->
            <section class="container mx-auto px-4 py-8 sm:py-16">
                <h2 class="text-3xl sm:text-4xl font-bold text-tertiary text-center mb-8 sm:mb-12">
                    <i class="fas fa-star mr-2"></i>Our Purpose
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Mission Card -->
                    <div class="glass-effect rounded-3xl overflow-hidden transform hover:scale-105 transition-all duration-300 hover:shadow-xl relative">
                        <div class="absolute top-0 right-0 w-24 h-24 bg-tertiary/10 rounded-bl-full z-0"></div>
                        <div class="absolute bottom-0 left-0 w-16 h-16 bg-tertiary/10 rounded-tr-full z-0"></div>
                        <div class="bg-tertiary p-4 text-center relative z-10">
                            <h3 class="text-2xl sm:text-3xl font-bold text-white">
                                <i class="fas fa-bullseye mr-2"></i>Our Mission
                            </h3>
                        </div>
                        <div class="p-6 sm:p-8 relative z-10">
                            <div class="flex justify-center mb-6">
                                <div class="w-20 h-20 rounded-full bg-tertiary/20 flex items-center justify-center shadow-lg border-2 border-tertiary/30">
                                    <i class="fas fa-compass text-4xl text-tertiary"></i>
                                </div>
                            </div>
                            <p class="text-gray-700 text-center text-lg leading-relaxed">
                                To empower Sangguniang Kabataan officials with efficient budget management tools that promote transparency,
                                accountability, and effective governance, enabling them to better serve the youth and communities of Dumingag,
                                Zamboanga del Sur.
                            </p>
                            <div class="flex justify-center mt-6">
                                <div class="h-1 w-16 bg-tertiary rounded-full"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Vision Card -->
                    <div class="glass-effect rounded-3xl overflow-hidden transform hover:scale-105 transition-all duration-300 hover:shadow-xl relative">
                        <div class="absolute top-0 right-0 w-24 h-24 bg-quaternary/10 rounded-bl-full z-0"></div>
                        <div class="absolute bottom-0 left-0 w-16 h-16 bg-quaternary/10 rounded-tr-full z-0"></div>
                        <div class="bg-quaternary p-4 text-center relative z-10">
                            <h3 class="text-2xl sm:text-3xl font-bold text-white">
                                <i class="fas fa-eye mr-2"></i>Our Vision
                            </h3>
                        </div>
                        <div class="p-6 sm:p-8 relative z-10">
                            <div class="flex justify-center mb-6">
                                <div class="w-20 h-20 rounded-full bg-quaternary/20 flex items-center justify-center shadow-lg border-2 border-quaternary/30">
                                    <i class="fas fa-lightbulb text-4xl text-quaternary"></i>
                                </div>
                            </div>
                            <p class="text-gray-700 text-center text-lg leading-relaxed">
                                To be the leading platform for youth governance in the Philippines, fostering a generation of
                                responsible and innovative SK leaders who drive sustainable community development through
                                transparent and effective resource management.
                            </p>
                            <div class="flex justify-center mt-6">
                                <div class="h-1 w-16 bg-quaternary rounded-full"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Features Section -->

            <!-- Recently Completed Projects Section -->
            <section class="container mx-auto px-4 py-8 sm:py-16">
                <div class="mb-6 sm:mb-12">
                    <h2 class="text-3xl sm:text-4xl font-bold text-tertiary text-center mb-6">
                        <i class="fas fa-trophy mr-2"></i>Recently Completed Projects
                    </h2>

                    <!-- Search Bar -->
                    <div id="stickySearch" class="relative w-full transition-all duration-300">
                        <div class="container mx-auto px-4">
                            <div class="glass-effect rounded-full shadow-lg">
                                <div class="relative">
                                    <input type="text" id="searchInput" placeholder="Search projects by title, chairman, location..."
                                           class="w-full pl-12 pr-12 py-3 bg-transparent text-tertiary placeholder-tertiary/60 rounded-full focus:outline-none">
                                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                        <i class="fas fa-search text-tertiary text-lg"></i>
                                    </div>
                                    <button id="clearSearch" class="absolute inset-y-0 right-0 pr-4 flex items-center text-tertiary hover:text-quaternary transition-colors duration-200 hidden">
                                        <i class="fas fa-times-circle text-lg"></i>
                                    </button>
                                </div>
                            </div>
                            <div id="searchResults" class="mt-2 glass-effect rounded-xl p-3 shadow-lg max-h-60 overflow-y-auto hidden">
                                <div id="resultsCount" class="text-sm text-tertiary mb-2 font-medium"></div>
                                <div id="noResults" class="text-center py-4 hidden">
                                    <i class="fas fa-search text-tertiary/50 text-3xl mb-2"></i>
                                    <p class="text-tertiary">No projects found matching your search.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="projectsContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-8">
                    {% regroup completed_projects by address as barangay_projects %}
                    {% for barangay in barangay_projects %}
                    <div class="barangay-card glass-effect rounded-3xl overflow-hidden transform hover:scale-105 transition-all duration-300 hover:shadow-xl cursor-pointer"
                         onclick="openProjectsModal('{{ barangay.grouper }}')"
                         data-barangay="{{ barangay.grouper|lower }}">
                        <div class="h-56 bg-tertiary relative overflow-hidden">
                            {% with first_project=barangay.list|first %}
                            {% if first_project.chairman_logo %}
                                <img src="{{ first_project.chairman_logo.url }}" alt="{{ barangay.grouper }}" class="w-full h-full object-contain p-4">
                            {% else %}
                                <div class="w-full h-full flex items-center justify-center bg-quaternary/80">
                                    <i class="fas fa-landmark text-7xl text-white opacity-50"></i>
                                </div>
                            {% endif %}
                            <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-6">
                                <h3 class="text-2xl font-bold text-white barangay-name">{{ barangay.grouper }}</h3>
                            </div>
                            {% endwith %}
                        </div>
                        <div class="p-6 space-y-4">
                            <div class="flex items-center space-x-4">
                                <div class="bg-tertiary/10 rounded-full p-3">
                                    <i class="fas fa-project-diagram text-tertiary text-xl"></i>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Completed Projects</p>
                                    <p class="font-semibold text-tertiary project-count">{{ barangay.list|length }}</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-4">
                                <div class="bg-tertiary/10 rounded-full p-3">
                                    <i class="fas fa-user-tie text-tertiary text-xl"></i>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Chairman</p>
                                    <p class="font-semibold text-tertiary project-chairman">{{ barangay.list.0.chairman_name }}</p>
                                </div>
                            </div>
                            <div class="flex justify-center mt-4 pt-4 border-t border-gray-200">
                                <button class="inline-flex items-center px-4 py-2 rounded-full text-sm font-medium bg-tertiary text-white hover:bg-quaternary transition-colors duration-300">
                                    <i class="fas fa-eye mr-1"></i>View Projects
                                </button>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="col-span-full glass-effect rounded-3xl p-12 text-center">
                        <i class="fas fa-info-circle text-6xl text-tertiary/50 mb-4"></i>
                        <p class="text-xl text-gray-600">No completed projects available at the moment.</p>
                        <p class="mt-4 text-gray-500">Completed projects will appear here once chairmen mark their projects as completed.</p>
                    </div>
                    {% endfor %}
                </div>

                <!-- Projects Modal -->
                <div id="projectsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 overflow-y-auto">
                    <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
                        <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-5xl sm:w-full">
                            <div class="bg-tertiary text-white px-4 py-5 sm:px-6 flex justify-between items-center">
                                <h3 class="text-2xl font-bold" id="modalBarangayTitle">
                                    <i class="fas fa-landmark mr-3"></i>Barangay Projects
                                </h3>
                                <button type="button" onclick="closeProjectsModal()" class="text-white hover:text-gray-200 focus:outline-none">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>
                            <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4 max-h-[75vh] overflow-y-auto">
                                <div id="modalProjectsList" class="space-y-6">
                                    <!-- Projects will be loaded here dynamically -->
                                </div>
                            </div>
                            <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                                <button type="button" onclick="closeProjectsModal()" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-tertiary text-base font-medium text-white hover:bg-quaternary focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-tertiary sm:ml-3 sm:w-auto sm:text-sm">
                                    Close
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Image Preview Modal -->
                <div id="imagePreviewModal" class="fixed inset-0 z-[60] overflow-auto bg-black bg-opacity-75 hidden flex items-center justify-center">
                    <div class="relative p-4 w-full max-w-4xl mx-auto">
                        <div class="bg-white rounded-lg shadow-xl overflow-hidden">
                            <div class="bg-tertiary text-white px-6 py-4 flex justify-between items-center">
                                <h3 id="imagePreviewTitle" class="text-lg font-bold">Image Preview</h3>
                                <button onclick="closeImagePreviewModal()" class="text-white hover:text-gray-200 focus:outline-none">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="p-6 flex items-center justify-center">
                                <img id="previewImage" src="" alt="Preview" class="max-w-full max-h-[70vh]">
                            </div>
                            <div class="bg-gray-100 px-6 py-3 flex justify-between items-center">
                                <p id="imageCaption" class="text-sm text-gray-700"></p>
                                <button onclick="closeImagePreviewModal()" class="bg-tertiary hover:bg-quaternary text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition duration-300">
                                    Close
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Call to Action Section -->
            <section class="container mx-auto px-4 py-8 sm:py-16 text-center">
                <div class="glass-effect rounded-3xl p-6 sm:p-12 max-w-4xl mx-auto">
                    <h2 class="text-2xl sm:text-3xl font-bold text-tertiary mb-4 sm:mb-6">
                        <i class="fas fa-handshake mr-2"></i>Join the SK Budget Community
                    </h2>
                    <p class="text-base sm:text-xl text-gray-700 mb-6 sm:mb-8">Start making a difference in your community today</p>
                    <a href="{% url 'register' %}" class="inline-block bg-tertiary hover:bg-quaternary text-white font-bold py-3 sm:py-4 px-6 sm:px-8 rounded-full text-base sm:text-xl transition duration-300 transform hover:scale-105 hover:shadow-lg">
                        <i class="fas fa-user-plus mr-2"></i>Sign Up Now
                    </a>
                </div>
            </section>

            <!-- Data Privacy Act Section -->
            <section id="privacySection" class="container mx-auto px-4 py-8 sm:py-12">
                <div class="glass-effect rounded-3xl p-6 sm:p-8 max-w-5xl mx-auto">
                    <div class="flex items-center justify-center mb-4">
                        <div class="bg-tertiary/10 rounded-full p-3">
                            <i class="fas fa-shield-alt text-tertiary text-2xl"></i>
                        </div>
                        <h2 class="text-xl sm:text-2xl font-bold text-tertiary ml-3">Data Privacy Act of 2012</h2>
                    </div>

                    <div class="text-gray-700 text-sm sm:text-base space-y-4">
                        <p class="text-center mb-4">
                            In compliance with Republic Act No. 10173, also known as the Data Privacy Act of 2012
                        </p>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-white/50 p-4 rounded-xl">
                                <h3 class="font-semibold text-tertiary mb-2 flex items-center">
                                    <i class="fas fa-info-circle mr-2"></i>Information We Collect
                                </h3>
                                <p>
                                    We collect personal information necessary for SK budget management, including names, contact details,
                                    addresses, and other information required for user registration and system functionality.
                                </p>
                            </div>

                            <div class="bg-white/50 p-4 rounded-xl">
                                <h3 class="font-semibold text-tertiary mb-2 flex items-center">
                                    <i class="fas fa-lock mr-2"></i>How We Protect Your Data
                                </h3>
                                <p>
                                    We implement appropriate data security measures to protect your personal information from unauthorized
                                    access, alteration, disclosure, or destruction.
                                </p>
                            </div>

                            <div class="bg-white/50 p-4 rounded-xl">
                                <h3 class="font-semibold text-tertiary mb-2 flex items-center">
                                    <i class="fas fa-file-contract mr-2"></i>Your Rights
                                </h3>
                                <p>
                                    You have the right to access, correct, and request deletion of your personal data, subject to
                                    any legal restrictions. Contact the system administrator for assistance with these requests.
                                </p>
                            </div>

                            <div class="bg-white/50 p-4 rounded-xl">
                                <h3 class="font-semibold text-tertiary mb-2 flex items-center">
                                    <i class="fas fa-handshake mr-2"></i>Consent
                                </h3>
                                <p>
                                    By using this system, you consent to the collection and processing of your personal information
                                    as described in this privacy notice and in accordance with the Data Privacy Act of 2012.
                                </p>
                            </div>
                        </div>

                        <p class="text-center text-xs sm:text-sm mt-4 text-gray-600">
                            For more information about the Data Privacy Act, visit the
                            <a href="https://www.privacy.gov.ph/" target="_blank" class="text-tertiary hover:underline">
                                National Privacy Commission website
                            </a>.
                        </p>
                    </div>
                </div>
            </section>
        </main>

        <footer class="glass-effect text-tertiary py-8 mt-16">
            <div class="container mx-auto px-4 text-center">
                <div class="flex justify-center items-center mb-4">
                    <img src="{% static 'img/dumingag-logo.png' %}" alt="Dumingag Logo" class="h-12">
                </div>
                <p><i class="far fa-copyright mr-2"></i>2024 SK Budget. All rights reserved.</p>
                <p class="mt-2 text-sm">Republic of the Philippines, Province of Zamboanga del Sur, Municipality of Dumingag</p>
            </div>
        </footer>

        <script>
            // Store all projects data for modal display
            const allProjects = [
                {% for project in completed_projects %}
                {
                    title: "{{ project.title }}",
                    chairman: "{{ project.chairman_name }}",
                    address: "{{ project.address }}",
                    date: "{{ project.completion_date|date:'F d, Y' }}",
                    description: "{% if project.description %}{{ project.description|escapejs }}{% endif %}",
                    image: "{% if project.image %}{{ project.image.url }}{% endif %}",
                    budget: "{{ project.budget }}",
                    chairman_logo: "{% if project.chairman_logo %}{{ project.chairman_logo.url }}{% endif %}",
                    accomplishment_reports: [
                        {% for report in project.accomplishment_reports %}
                        {
                            date: "{{ report.date|date:'F d, Y' }}",
                            details: "{{ report.details|escapejs }}",
                            images: [
                                {% for img in report.images %}
                                {
                                    url: "{{ img.url }}",
                                    caption: "{{ img.caption|escapejs }}"
                                }{% if not forloop.last %},{% endif %}
                                {% endfor %}
                            ]
                        }{% if not forloop.last %},{% endif %}
                        {% endfor %}
                    ]
                }{% if not forloop.last %},{% endif %}
                {% endfor %}
            ];

            // List of barangays in Dumingag, Zamboanga del Sur
            const barangayList = [
                "Bagong Kauswagan", "Bagong Silang", "Bagumbayan", "Balonai",
                "Bitoon", "Blanquita", "Bonifacio", "Bucayan", "Calumanggi",
                "Canibongan", "Caridad", "Datu Totoca", "Ditulan", "Dulop",
                "Guitran", "Guling", "Gumpingan", "Labangon", "Licabang",
                "Lipawan", "Lower Landing", "Lower Timonan", "Macasing",
                "Mahayahay", "Manuel Iyao", "New Basak", "Ocapan", "Poblacion",
                "Saad", "San Pablo", "San Pedro", "Sarakan", "Sebucao",
                "Senote", "Sinonok", "Sunop", "Tagun", "Tamurayan",
                "Tigbao", "Upper Landing", "Upper Timonan"
            ];

            // Function to open the projects modal
            function openProjectsModal(barangayName) {
                // Set the modal title
                document.getElementById('modalBarangayTitle').innerHTML = `<i class="fas fa-landmark mr-3"></i>Barangay ${barangayName}`;

                // Filter projects for this barangay
                const barangayProjects = allProjects.filter(project => project.address === barangayName);

                // Generate HTML for each project
                let projectsHTML = '';

                if (barangayProjects.length > 0) {
                    barangayProjects.forEach(project => {
                        // Start with the project details
                        let projectHTML = `
                            <div class="project-item border-b border-gray-200 pb-6 mb-8">
                                <div class="flex flex-col md:flex-row">
                                    <div class="md:w-1/3 mb-4 md:mb-0 md:mr-6">
                                        ${project.image ?
                                            `<img src="${project.image}" alt="${project.title}" class="w-full h-48 object-cover rounded-lg">` :
                                            `<div class="w-full h-48 flex items-center justify-center bg-quaternary/30 rounded-lg">
                                                <i class="fas fa-project-diagram text-5xl text-tertiary opacity-50"></i>
                                            </div>`
                                        }
                                    </div>
                                    <div class="md:w-2/3">
                                        <h4 class="text-xl font-bold text-tertiary mb-2">${project.title}</h4>
                                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                            <div class="flex items-center">
                                                <div class="bg-tertiary/10 rounded-full p-2 mr-3">
                                                    <i class="fas fa-user-tie text-tertiary"></i>
                                                </div>
                                                <div>
                                                    <p class="text-xs text-gray-500">Chairman</p>
                                                    <p class="text-sm font-medium">${project.chairman}</p>
                                                </div>
                                            </div>
                                            <div class="flex items-center">
                                                <div class="bg-tertiary/10 rounded-full p-2 mr-3">
                                                    <i class="fas fa-calendar-check text-tertiary"></i>
                                                </div>
                                                <div>
                                                    <p class="text-xs text-gray-500">Completed</p>
                                                    <p class="text-sm font-medium">${project.date}</p>
                                                </div>
                                            </div>
                                            <div class="flex items-center">
                                                <div class="bg-tertiary/10 rounded-full p-2 mr-3">
                                                    <i class="fas fa-money-bill-wave text-tertiary"></i>
                                                </div>
                                                <div>
                                                    <p class="text-xs text-gray-500">Budget</p>
                                                    <p class="text-sm font-medium">₱ ${parseFloat(project.budget).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</p>
                                                </div>
                                            </div>
                                        </div>
                                        <p class="text-gray-600 text-sm">${project.description || 'No description available.'}</p>
                                    </div>
                                </div>
                        `;

                        // Add accomplishment reports section if available
                        if (project.accomplishment_reports && project.accomplishment_reports.length > 0) {
                            projectHTML += `
                                <div class="mt-6">
                                    <h5 class="text-lg font-semibold text-tertiary mb-3">
                                        <i class="fas fa-clipboard-check mr-2"></i>Accomplishment Reports
                                    </h5>
                                    <div class="space-y-4">
                            `;

                            // Add each accomplishment report
                            project.accomplishment_reports.forEach(report => {
                                projectHTML += `
                                    <div class="bg-gray-50 rounded-lg p-4">
                                        <h6 class="font-medium text-tertiary mb-2">
                                            <i class="fas fa-calendar-alt mr-2"></i>${report.date}
                                        </h6>
                                        <p class="text-sm text-gray-600 mb-3">${report.details || 'No details available.'}</p>
                                `;

                                // Add images if available
                                if (report.images && report.images.length > 0) {
                                    projectHTML += `
                                        <div class="mt-3">
                                            <p class="text-xs text-gray-500 mb-2">Report Images:</p>
                                            <div class="grid grid-cols-2 sm:grid-cols-3 gap-2">
                                    `;

                                    report.images.forEach(img => {
                                        if (img.url) {
                                            projectHTML += `
                                                <div class="relative group" onclick="openImagePreviewModal('${img.url}', '${img.caption || ''}')">
                                                    <img src="${img.url}" alt="${img.caption || 'Project image'}"
                                                         class="h-24 w-full object-cover rounded-lg cursor-pointer hover:opacity-90 transition-opacity">
                                                    ${img.caption ? `
                                                    <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 flex items-end justify-center transition-all duration-300 opacity-0 group-hover:opacity-100">
                                                        <p class="text-white text-xs p-1 truncate w-full text-center bg-black bg-opacity-70">${img.caption}</p>
                                                    </div>` : ''}
                                                    <div class="absolute top-1 right-1 bg-tertiary text-white rounded-full w-5 h-5 flex items-center justify-center opacity-70">
                                                        <i class="fas fa-search-plus text-xs"></i>
                                                    </div>
                                                </div>
                                            `;
                                        }
                                    });

                                    projectHTML += `
                                            </div>
                                        </div>
                                    `;
                                }

                                projectHTML += `
                                    </div>
                                `;
                            });

                            projectHTML += `
                                    </div>
                                </div>
                            `;
                        }

                        // Close the project item div
                        projectHTML += `
                            </div>
                        `;

                        projectsHTML += projectHTML;
                    });
                } else {
                    // Get recent projects from OTHER barangays as reference (up to 3)
                    const recentProjects = [...allProjects]
                        .filter(project => project.address !== barangayName) // Exclude current barangay
                        .sort((a, b) => new Date(b.date) - new Date(a.date))
                        .slice(0, 3);

                    projectsHTML = `
                        <div class="text-center py-6 mb-8">
                            <i class="fas fa-info-circle text-4xl text-tertiary/50 mb-4"></i>
                            <p class="text-lg text-gray-600">No projects found for Barangay ${barangayName}.</p>
                            <p class="text-sm text-gray-500 mt-2">Projects will appear here once completed by the barangay chairman.</p>
                        </div>
                    `;

                    // Only show recent projects if there are any from other barangays
                    if (recentProjects.length > 0 && allProjects.some(project => project.address !== barangayName)) {
                        projectsHTML += `
                            <div class="border-t border-gray-200 pt-8">
                                <h4 class="text-xl font-semibold text-tertiary mb-6 flex items-center">
                                    <i class="fas fa-clock mr-3"></i>Recent Projects From Different Barangays
                                </h4>
                                <div class="space-y-8">
                        `;

                        // Add recent projects
                        recentProjects.forEach(project => {
                            projectsHTML += `
                                <div class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors duration-300 cursor-pointer"
                                     onclick="openProjectsModal('${project.address}')">
                                    <div class="flex flex-col md:flex-row">
                                        <div class="md:w-1/4 mb-4 md:mb-0 md:mr-4">
                                            ${project.image ?
                                                `<img src="${project.image}" alt="${project.title}" class="w-full h-32 object-cover rounded-lg">` :
                                                `<div class="w-full h-32 flex items-center justify-center bg-quaternary/30 rounded-lg">
                                                    <i class="fas fa-project-diagram text-3xl text-tertiary opacity-50"></i>
                                                </div>`
                                            }
                                        </div>
                                        <div class="md:w-3/4">
                                            <div class="flex justify-between items-start mb-2">
                                                <h5 class="text-lg font-medium text-tertiary">${project.title}</h5>
                                                <span class="bg-tertiary/10 text-tertiary text-xs px-2 py-1 rounded-full">
                                                    ${project.address}
                                                </span>
                                            </div>
                                            <div class="flex items-center text-sm text-gray-500 mb-2">
                                                <i class="fas fa-calendar-check mr-2"></i>${project.date}
                                            </div>
                                            <p class="text-sm text-gray-600 line-clamp-2">${project.description || 'No description available.'}</p>
                                            <div class="mt-3 text-right">
                                                <span class="text-xs text-tertiary inline-flex items-center">
                                                    <i class="fas fa-arrow-right mr-1"></i>View All Projects from ${project.address}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        });

                        projectsHTML += `
                                </div>
                            </div>
                        `;
                    }
                }

                // Update the modal content
                document.getElementById('modalProjectsList').innerHTML = projectsHTML;

                // Show the modal
                const modal = document.getElementById('projectsModal');
                modal.classList.remove('hidden');
            }

            // Function to open modal with only recent completed projects
            function openRecentProjectsModal(barangayName) {
                // Set the modal title
                document.getElementById('modalBarangayTitle').innerHTML = `<i class="fas fa-landmark mr-3"></i>Recent Projects - Barangay ${barangayName}`;

                // Filter projects for this barangay
                const barangayProjects = allProjects.filter(project => project.address === barangayName);

                // Sort projects by date (most recent first) and take only the most recent ones (up to 5)
                const recentProjects = [...barangayProjects]
                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                    .slice(0, 5);

                // Generate HTML for each project
                let projectsHTML = '';

                if (recentProjects.length > 0) {
                    projectsHTML += `
                        <div class="mb-6 pb-4 border-b border-gray-200">
                            <h4 class="text-lg font-semibold text-tertiary flex items-center">
                                <i class="fas fa-clock mr-2"></i>Recently Completed Projects
                                <span class="ml-2 text-sm font-normal text-gray-500">(Showing ${recentProjects.length} of ${barangayProjects.length} total projects)</span>
                            </h4>
                        </div>
                    `;

                    recentProjects.forEach(project => {
                        // Start with the project details
                        let projectHTML = `
                            <div class="project-item border-b border-gray-200 pb-6 mb-8">
                                <div class="flex flex-col md:flex-row">
                                    <div class="md:w-1/3 mb-4 md:mb-0 md:mr-6">
                                        ${project.image ?
                                            `<img src="${project.image}" alt="${project.title}" class="w-full h-48 object-cover rounded-lg">` :
                                            `<div class="w-full h-48 flex items-center justify-center bg-quaternary/30 rounded-lg">
                                                <i class="fas fa-project-diagram text-5xl text-tertiary opacity-50"></i>
                                            </div>`
                                        }
                                    </div>
                                    <div class="md:w-2/3">
                                        <h4 class="text-xl font-bold text-tertiary mb-2">${project.title}</h4>
                                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                            <div class="flex items-center">
                                                <div class="bg-tertiary/10 rounded-full p-2 mr-3">
                                                    <i class="fas fa-user-tie text-tertiary"></i>
                                                </div>
                                                <div>
                                                    <p class="text-xs text-gray-500">Chairman</p>
                                                    <p class="text-sm font-medium">${project.chairman}</p>
                                                </div>
                                            </div>
                                            <div class="flex items-center">
                                                <div class="bg-tertiary/10 rounded-full p-2 mr-3">
                                                    <i class="fas fa-calendar-check text-tertiary"></i>
                                                </div>
                                                <div>
                                                    <p class="text-xs text-gray-500">Completed</p>
                                                    <p class="text-sm font-medium">${project.date}</p>
                                                </div>
                                            </div>
                                            <div class="flex items-center">
                                                <div class="bg-tertiary/10 rounded-full p-2 mr-3">
                                                    <i class="fas fa-money-bill-wave text-tertiary"></i>
                                                </div>
                                                <div>
                                                    <p class="text-xs text-gray-500">Budget</p>
                                                    <p class="text-sm font-medium">₱ ${parseFloat(project.budget).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</p>
                                                </div>
                                            </div>
                                        </div>
                                        <p class="text-gray-600 text-sm">${project.description || 'No description available.'}</p>
                                    </div>
                                </div>
                        `;

                        // Add accomplishment reports section if available
                        if (project.accomplishment_reports && project.accomplishment_reports.length > 0) {
                            projectHTML += `
                                <div class="mt-6">
                                    <h5 class="text-lg font-semibold text-tertiary mb-3">
                                        <i class="fas fa-clipboard-check mr-2"></i>Accomplishment Reports
                                    </h5>
                                    <div class="space-y-4">
                            `;

                            // Add each accomplishment report
                            project.accomplishment_reports.forEach(report => {
                                projectHTML += `
                                    <div class="bg-gray-50 rounded-lg p-4">
                                        <h6 class="font-medium text-tertiary mb-2">
                                            <i class="fas fa-calendar-alt mr-2"></i>${report.date}
                                        </h6>
                                        <p class="text-sm text-gray-600 mb-3">${report.details || 'No details available.'}</p>
                                `;

                                // Add images if available
                                if (report.images && report.images.length > 0) {
                                    projectHTML += `
                                        <div class="mt-3">
                                            <p class="text-xs text-gray-500 mb-2">Report Images:</p>
                                            <div class="grid grid-cols-2 sm:grid-cols-3 gap-2">
                                    `;

                                    report.images.forEach(img => {
                                        if (img.url) {
                                            projectHTML += `
                                                <div class="relative group" onclick="openImagePreviewModal('${img.url}', '${img.caption || ''}')">
                                                    <img src="${img.url}" alt="${img.caption || 'Project image'}"
                                                         class="h-24 w-full object-cover rounded-lg cursor-pointer hover:opacity-90 transition-opacity">
                                                    ${img.caption ? `
                                                    <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 flex items-end justify-center transition-all duration-300 opacity-0 group-hover:opacity-100">
                                                        <p class="text-white text-xs p-1 truncate w-full text-center bg-black bg-opacity-70">${img.caption}</p>
                                                    </div>` : ''}
                                                    <div class="absolute top-1 right-1 bg-tertiary text-white rounded-full w-5 h-5 flex items-center justify-center opacity-70">
                                                        <i class="fas fa-search-plus text-xs"></i>
                                                    </div>
                                                </div>
                                            `;
                                        }
                                    });

                                    projectHTML += `
                                            </div>
                                        </div>
                                    `;
                                }

                                projectHTML += `
                                    </div>
                                `;
                            });

                            projectHTML += `
                                    </div>
                                </div>
                            `;
                        }

                        // Close the project item div
                        projectHTML += `
                            </div>
                        `;

                        projectsHTML += projectHTML;
                    });

                    // Add a button to view all projects if there are more
                    if (barangayProjects.length > recentProjects.length) {
                        projectsHTML += `
                            <div class="text-center mt-6 pt-4 border-t border-gray-200">
                                <button onclick="openProjectsModal('${barangayName}')" class="inline-flex items-center px-6 py-3 rounded-full text-base font-medium bg-tertiary text-white hover:bg-quaternary transition-colors duration-300">
                                    <i class="fas fa-list-ul mr-2"></i>View All ${barangayProjects.length} Projects
                                </button>
                            </div>
                        `;
                    }
                } else {
                    projectsHTML = `
                        <div class="text-center py-6 mb-8">
                            <i class="fas fa-info-circle text-4xl text-tertiary/50 mb-4"></i>
                            <p class="text-lg text-gray-600">No projects found for Barangay ${barangayName}.</p>
                            <p class="text-sm text-gray-500 mt-2">Projects will appear here once completed by the barangay chairman.</p>
                        </div>
                    `;
                }

                // Update the modal content
                document.getElementById('modalProjectsList').innerHTML = projectsHTML;

                // Show the modal
                const modal = document.getElementById('projectsModal');
                modal.classList.remove('hidden');
            }

            // Function to close the projects modal
            function closeProjectsModal() {
                const modal = document.getElementById('projectsModal');
                modal.classList.add('hidden');
            }

            // Function to open image preview modal
            function openImagePreviewModal(imageUrl, caption) {
                const modal = document.getElementById('imagePreviewModal');
                const previewImage = document.getElementById('previewImage');
                const imageCaption = document.getElementById('imageCaption');

                previewImage.src = imageUrl;
                imageCaption.textContent = caption || '';

                modal.classList.remove('hidden');
                modal.classList.add('flex');
            }

            // Function to close image preview modal
            function closeImagePreviewModal() {
                const modal = document.getElementById('imagePreviewModal');
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }

            // Close modals when clicking outside
            document.addEventListener('click', function(event) {
                const projectsModal = document.getElementById('projectsModal');
                if (event.target === projectsModal) {
                    closeProjectsModal();
                }

                const imagePreviewModal = document.getElementById('imagePreviewModal');
                if (event.target === imagePreviewModal) {
                    closeImagePreviewModal();
                }
            });

            document.addEventListener('DOMContentLoaded', function() {
                // Elements
                const stickySearch = document.getElementById('stickySearch');
                const searchInput = document.getElementById('searchInput');
                const clearSearch = document.getElementById('clearSearch');
                const searchResults = document.getElementById('searchResults');
                const resultsCount = document.getElementById('resultsCount');
                const noResults = document.getElementById('noResults');
                const barangayCards = document.querySelectorAll('.barangay-card');
                const projectsContainer = document.getElementById('projectsContainer');

                // Generate barangay logo banner
                const barangayLogosContainer = document.querySelector('.barangay-logos-container');

                // Function to generate a random icon for each barangay
                function getRandomIcon() {
                    const icons = [
                        'fa-landmark', 'fa-mountain', 'fa-tree', 'fa-water',
                        'fa-sun', 'fa-seedling', 'fa-leaf', 'fa-home',
                        'fa-church', 'fa-school', 'fa-store', 'fa-building',
                        'fa-flag', 'fa-star', 'fa-compass', 'fa-map-marker-alt'
                    ];
                    return icons[Math.floor(Math.random() * icons.length)];
                }

                // Generate barangay logos
                if (barangayLogosContainer) {
                    // Shuffle the barangay list to display a random selection
                    const shuffledBarangays = [...barangayList].sort(() => 0.5 - Math.random());
                    // Take only the first 12 for display (or fewer if the list is shorter)
                    const displayBarangays = shuffledBarangays.slice(0, 12);

                    // Function to create a barangay logo item
                    function createBarangayLogoItem(barangay) {
                        const logoItem = document.createElement('div');
                        logoItem.className = 'barangay-logo-item';
                        logoItem.setAttribute('data-barangay', barangay);

                        // Check if we have projects for this barangay
                        const barangayProjects = allProjects.filter(project =>
                            project.address.toLowerCase().includes(barangay.toLowerCase())
                        );

                        const hasProjects = barangayProjects.length > 0;

                        // Find the barangay logo if available
                        let logoUrl = null;
                        if (hasProjects) {
                            // Try to find a project with a chairman logo
                            for (const project of barangayProjects) {
                                if (project.chairman_logo && project.chairman_logo.trim() !== '') {
                                    logoUrl = project.chairman_logo;
                                    break;
                                }
                            }
                        }

                        // Create logo container
                        const logoContainer = document.createElement('div');
                        logoContainer.className = 'barangay-logo-image';

                        // If we have a logo, use it; otherwise use an icon
                        if (logoUrl) {
                            const img = document.createElement('img');
                            img.src = logoUrl;
                            img.alt = barangay;
                            img.className = 'w-full h-full object-contain';
                            logoContainer.appendChild(img);
                        } else {
                            // Create a fallback icon
                            const icon = document.createElement('i');
                            icon.className = `fas ${getRandomIcon()} barangay-logo-icon`;
                            logoContainer.appendChild(icon);
                        }

                        // Create the name element
                        const name = document.createElement('div');
                        name.className = 'barangay-logo-name';
                        name.textContent = barangay;

                        // Add elements to the logo item
                        logoItem.appendChild(logoContainer);
                        logoItem.appendChild(name);

                        // Add click event for all barangays - show only recent projects when clicking on logo
                        logoItem.addEventListener('click', () => {
                            openRecentProjectsModal(barangay);
                        });

                        // Add visual indicator based on whether there are projects
                        if (hasProjects) {
                            // Add a small indicator that it has projects
                            const indicator = document.createElement('div');
                            indicator.className = 'absolute bottom-1 right-1 w-3 h-3 bg-quaternary rounded-full';
                            logoItem.appendChild(indicator);
                        } else {
                            // Still make it clickable but with a different indicator
                            logoItem.style.opacity = '0.9';
                            const indicator = document.createElement('div');
                            indicator.className = 'absolute bottom-1 right-1 w-3 h-3 bg-gray-300 rounded-full';
                            logoItem.appendChild(indicator);
                        }

                        return logoItem;
                    }

                    // Create logo items for initial display
                    displayBarangays.forEach(barangay => {
                        barangayLogosContainer.appendChild(createBarangayLogoItem(barangay));
                    });

                    // Handle "View All Barangays" button click
                    const viewAllButton = document.getElementById('viewAllBarangays');
                    if (viewAllButton) {
                        viewAllButton.addEventListener('click', function() {
                            // Clear current logos
                            barangayLogosContainer.innerHTML = '';

                            // Add all barangays
                            barangayList.forEach(barangay => {
                                barangayLogosContainer.appendChild(createBarangayLogoItem(barangay));
                            });

                            // Change button text and disable it
                            this.innerHTML = '<i class="fas fa-check-circle mr-2"></i>Showing All Barangays';
                            this.disabled = true;
                            this.classList.add('opacity-70', 'cursor-not-allowed');

                            // Animate the new logos
                            gsap.from(".barangay-logo-item", {
                                duration: 0.5,
                                scale: 0.5,
                                opacity: 0,
                                stagger: 0.02,
                                ease: "back.out(1.7)"
                            });
                        });
                    }
                }

                // Variables to track state
                let searchDebounceTimer;
                let projectsSection = document.querySelector('.barangay-card')?.closest('section');
                // Find the heading by looking for the h2 that contains the trophy icon
                let projectsHeading = document.querySelector('h2 i.fa-trophy')?.closest('h2');

                // Make search sticky when scrolling
                window.addEventListener('scroll', function() {
                    if (stickySearch && projectsHeading) {
                        const headingRect = projectsHeading.getBoundingClientRect();
                        const headingBottom = headingRect.bottom;

                        if (headingBottom < 0) {
                            // We've scrolled past the heading, make search sticky
                            stickySearch.classList.add('fixed', 'top-16', 'z-40');
                            stickySearch.classList.remove('relative');

                            // Add padding to prevent content jump
                            if (!document.getElementById('searchSpacer')) {
                                const spacer = document.createElement('div');
                                spacer.id = 'searchSpacer';
                                spacer.style.height = stickySearch.offsetHeight + 'px';
                                stickySearch.parentNode.insertBefore(spacer, stickySearch.nextSibling);
                            }
                        } else {
                            // We're at or above the heading, return search to normal position
                            stickySearch.classList.remove('fixed', 'top-16', 'z-40');
                            stickySearch.classList.add('relative');

                            // Remove the spacer if it exists
                            const spacer = document.getElementById('searchSpacer');
                            if (spacer) spacer.remove();
                        }
                    }
                });

                // Clear search button
                if (clearSearch) {
                    clearSearch.addEventListener('click', function() {
                        searchInput.value = '';
                        searchInput.focus();
                        clearSearch.classList.add('hidden');
                        filterBarangays('');
                        searchResults.classList.add('hidden');
                    });
                }

                // Search input handler
                if (searchInput) {
                    searchInput.addEventListener('input', function() {
                        const searchTerm = this.value.trim().toLowerCase();

                        // Show/hide clear button
                        if (searchTerm.length > 0) {
                            clearSearch.classList.remove('hidden');
                        } else {
                            clearSearch.classList.add('hidden');
                        }

                        // Debounce search for better performance
                        clearTimeout(searchDebounceTimer);
                        searchDebounceTimer = setTimeout(() => {
                            filterBarangays(searchTerm);
                        }, 300);
                    });

                    // Handle escape key to clear search
                    searchInput.addEventListener('keydown', function(e) {
                        if (e.key === 'Escape') {
                            searchInput.value = '';
                            clearSearch.classList.add('hidden');
                            filterBarangays('');
                            searchResults.classList.add('hidden');
                        }
                    });
                }

                // Filter barangays based on search term
                function filterBarangays(searchTerm) {
                    if (!barangayCards.length) return;

                    let visibleCount = 0;
                    let highlightedResults = [];

                    barangayCards.forEach(card => {
                        const barangay = card.dataset.barangay || '';
                        const chairman = card.querySelector('.project-chairman')?.textContent.toLowerCase() || '';

                        const allText = `${barangay} ${chairman}`;

                        if (searchTerm === '' || allText.includes(searchTerm)) {
                            card.style.display = '';
                            visibleCount++;

                            // If this is a strong match, add to highlighted results
                            if (searchTerm !== '' && (barangay.includes(searchTerm) || chairman.includes(searchTerm))) {
                                highlightedResults.push(card);
                            }
                        } else {
                            card.style.display = 'none';
                        }
                    });

                    // Update results count and visibility
                    if (searchTerm !== '') {
                        searchResults.classList.remove('hidden');

                        if (visibleCount > 0) {
                            resultsCount.textContent = `Found ${visibleCount} barangay${visibleCount !== 1 ? 's' : ''} matching "${searchTerm}"`;
                            noResults.classList.add('hidden');

                            // Move highlighted results to the top if searching
                            if (highlightedResults.length > 0) {
                                highlightedResults.forEach(card => {
                                    projectsContainer.prepend(card);
                                });
                            }
                        } else {
                            resultsCount.textContent = '';
                            noResults.classList.remove('hidden');
                        }
                    } else {
                        searchResults.classList.add('hidden');

                        // Restore original order when search is cleared
                        const originalOrder = Array.from(barangayCards);
                        originalOrder.sort((a, b) => {
                            const nameA = a.querySelector('.barangay-name')?.textContent || '';
                            const nameB = b.querySelector('.barangay-name')?.textContent || '';
                            return nameA.localeCompare(nameB); // Alphabetical order
                        });

                        originalOrder.forEach(card => {
                            projectsContainer.appendChild(card);
                        });
                    }
                }
            });

            // Animate elements on scroll
            function animateOnScroll() {
                gsap.from(".glass-effect:not(#stickySearch, #searchResults)", {
                    scrollTrigger: {
                        trigger: ".glass-effect",
                        start: "top bottom",
                        toggleActions: "play none none reverse"
                    },
                    y: 50,
                    opacity: 0,
                    duration: 1,
                    stagger: 0.2,
                    ease: "power3.out"
                });
            }

            // Initial animations
            gsap.from("h1, h2", {
                duration: 1,
                y: -30,
                opacity: 0,
                stagger: 0.2,
                ease: "power2.out"
            });

            gsap.from(".feature-card", {
                duration: 1,
                y: 50,
                opacity: 0,
                stagger: 0.2,
                ease: "power3.out"
            });

            // Animate barangay logo items
            gsap.from(".barangay-logo-item", {
                duration: 0.8,
                scale: 0.5,
                opacity: 0,
                stagger: 0.05,
                ease: "back.out(1.7)",
                delay: 0.3
            });

            // Mission and Vision animations
            const missionVisionSection = document.querySelector('.grid-cols-1.md\\:grid-cols-2');
            if (missionVisionSection) {
                const cards = missionVisionSection.querySelectorAll('.glass-effect');
                gsap.from(cards[0], {
                    duration: 1,
                    x: -50,
                    opacity: 0,
                    delay: 0.3,
                    ease: "back.out(1.7)"
                });
                gsap.from(cards[1], {
                    duration: 1,
                    x: 50,
                    opacity: 0,
                    delay: 0.3,
                    ease: "back.out(1.7)"
                });
            }

            // Data Privacy Act animations
            // Add an ID to the privacy section for easier targeting
            const privacySection = document.getElementById('privacySection');
            if (privacySection) {
                // Animate the header
                gsap.from(privacySection.querySelector('.flex.items-center.justify-center'), {
                    scrollTrigger: {
                        trigger: privacySection,
                        start: "top 80%",
                        toggleActions: "play none none reverse"
                    },
                    y: -20,
                    opacity: 0,
                    duration: 0.8,
                    ease: "power2.out"
                });

                // Animate the cards with stagger
                gsap.from(privacySection.querySelectorAll('.bg-white\\/50'), {
                    scrollTrigger: {
                        trigger: privacySection,
                        start: "top 70%",
                        toggleActions: "play none none reverse"
                    },
                    y: 30,
                    opacity: 0,
                    duration: 0.8,
                    stagger: 0.15,
                    ease: "power3.out"
                });
            }

            // Initialize scroll animations
            if (typeof ScrollTrigger !== 'undefined') {
                gsap.registerPlugin(ScrollTrigger);
                animateOnScroll();
            }
        </script>
    </body>
</html>
